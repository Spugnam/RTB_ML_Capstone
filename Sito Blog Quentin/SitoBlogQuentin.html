<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ul.lst-kix_9e3u2uh7e01s-3{list-style-type:none}ul.lst-kix_9e3u2uh7e01s-2{list-style-type:none}.lst-kix_uw0t939ffmne-4>li:before{content:"-  "}ul.lst-kix_9e3u2uh7e01s-1{list-style-type:none}ul.lst-kix_9e3u2uh7e01s-0{list-style-type:none}.lst-kix_uw0t939ffmne-3>li:before{content:"-  "}ul.lst-kix_9e3u2uh7e01s-7{list-style-type:none}ul.lst-kix_9e3u2uh7e01s-6{list-style-type:none}ul.lst-kix_9e3u2uh7e01s-5{list-style-type:none}ul.lst-kix_9e3u2uh7e01s-4{list-style-type:none}.lst-kix_uw0t939ffmne-1>li:before{content:"-  "}.lst-kix_uw0t939ffmne-2>li:before{content:"-  "}ul.lst-kix_9e3u2uh7e01s-8{list-style-type:none}.lst-kix_iwy209t32j51-6>li:before{content:"-  "}.lst-kix_iwy209t32j51-8>li:before{content:"-  "}.lst-kix_uw0t939ffmne-0>li:before{content:"-  "}.lst-kix_iwy209t32j51-7>li:before{content:"-  "}.lst-kix_7t911kc8ekh1-4>li:before{content:"\0025cb  "}.lst-kix_7t911kc8ekh1-5>li:before{content:"\0025a0  "}.lst-kix_9e3u2uh7e01s-6>li:before{content:"\0025cf  "}.lst-kix_9e3u2uh7e01s-8>li:before{content:"\0025a0  "}.lst-kix_7t911kc8ekh1-2>li:before{content:"\0025a0  "}.lst-kix_7t911kc8ekh1-3>li:before{content:"\0025cf  "}.lst-kix_7t911kc8ekh1-6>li:before{content:"\0025cf  "}.lst-kix_7t911kc8ekh1-7>li:before{content:"\0025cb  "}.lst-kix_9e3u2uh7e01s-7>li:before{content:"\0025cb  "}.lst-kix_7t911kc8ekh1-8>li:before{content:"\0025a0  "}ul.lst-kix_uw0t939ffmne-8{list-style-type:none}.lst-kix_iwy209t32j51-2>li:before{content:"-  "}ul.lst-kix_uw0t939ffmne-6{list-style-type:none}ul.lst-kix_uw0t939ffmne-7{list-style-type:none}.lst-kix_iwy209t32j51-1>li:before{content:"-  "}.lst-kix_iwy209t32j51-5>li:before{content:"-  "}.lst-kix_iwy209t32j51-4>li:before{content:"-  "}.lst-kix_iwy209t32j51-3>li:before{content:"-  "}.lst-kix_uw0t939ffmne-5>li:before{content:"-  "}.lst-kix_uw0t939ffmne-6>li:before{content:"-  "}ul.lst-kix_uw0t939ffmne-0{list-style-type:none}.lst-kix_uw0t939ffmne-7>li:before{content:"-  "}ul.lst-kix_uw0t939ffmne-1{list-style-type:none}.lst-kix_7t911kc8ekh1-0>li:before{content:"\0025cf  "}.lst-kix_7t911kc8ekh1-1>li:before{content:"\0025cb  "}ul.lst-kix_uw0t939ffmne-4{list-style-type:none}.lst-kix_iwy209t32j51-0>li:before{content:"-  "}ul.lst-kix_uw0t939ffmne-5{list-style-type:none}ul.lst-kix_uw0t939ffmne-2{list-style-type:none}.lst-kix_uw0t939ffmne-8>li:before{content:"-  "}ul.lst-kix_uw0t939ffmne-3{list-style-type:none}.lst-kix_8l7c42d7d1sl-3>li:before{content:"\0025cf  "}.lst-kix_8l7c42d7d1sl-5>li:before{content:"\0025a0  "}.lst-kix_8l7c42d7d1sl-0>li:before{content:"\0025cf  "}.lst-kix_8l7c42d7d1sl-4>li:before{content:"\0025cb  "}.lst-kix_8l7c42d7d1sl-1>li:before{content:"\0025cb  "}.lst-kix_8l7c42d7d1sl-2>li:before{content:"\0025a0  "}.lst-kix_8l7c42d7d1sl-8>li:before{content:"\0025a0  "}.lst-kix_8l7c42d7d1sl-7>li:before{content:"\0025cb  "}.lst-kix_8l7c42d7d1sl-6>li:before{content:"\0025cf  "}ul.lst-kix_8l7c42d7d1sl-2{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-3{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-4{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-5{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-6{list-style-type:none}ul.lst-kix_end0j8ux220d-7{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-7{list-style-type:none}ul.lst-kix_end0j8ux220d-8{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-8{list-style-type:none}.lst-kix_9e3u2uh7e01s-3>li:before{content:"\0025cf  "}.lst-kix_9e3u2uh7e01s-4>li:before{content:"\0025cb  "}ul.lst-kix_8l7c42d7d1sl-0{list-style-type:none}ul.lst-kix_8l7c42d7d1sl-1{list-style-type:none}.lst-kix_9e3u2uh7e01s-5>li:before{content:"\0025a0  "}.lst-kix_end0j8ux220d-0>li:before{content:"\0025cf  "}.lst-kix_end0j8ux220d-2>li:before{content:"\0025a0  "}.lst-kix_end0j8ux220d-1>li:before{content:"\0025cb  "}ul.lst-kix_end0j8ux220d-3{list-style-type:none}ul.lst-kix_end0j8ux220d-4{list-style-type:none}ul.lst-kix_end0j8ux220d-5{list-style-type:none}.lst-kix_end0j8ux220d-6>li:before{content:"\0025cf  "}ul.lst-kix_end0j8ux220d-6{list-style-type:none}.lst-kix_9e3u2uh7e01s-2>li:before{content:"\0025a0  "}ul.lst-kix_end0j8ux220d-0{list-style-type:none}ul.lst-kix_end0j8ux220d-1{list-style-type:none}ul.lst-kix_end0j8ux220d-2{list-style-type:none}.lst-kix_end0j8ux220d-7>li:before{content:"\0025cb  "}.lst-kix_9e3u2uh7e01s-1>li:before{content:"\0025cb  "}.lst-kix_9e3u2uh7e01s-0>li:before{content:"\0025cf  "}.lst-kix_end0j8ux220d-5>li:before{content:"\0025a0  "}.lst-kix_end0j8ux220d-4>li:before{content:"\0025cb  "}.lst-kix_end0j8ux220d-3>li:before{content:"\0025cf  "}ul.lst-kix_iwy209t32j51-8{list-style-type:none}ul.lst-kix_iwy209t32j51-7{list-style-type:none}ul.lst-kix_iwy209t32j51-6{list-style-type:none}ul.lst-kix_iwy209t32j51-1{list-style-type:none}ul.lst-kix_iwy209t32j51-0{list-style-type:none}ul.lst-kix_iwy209t32j51-5{list-style-type:none}ul.lst-kix_iwy209t32j51-4{list-style-type:none}ul.lst-kix_iwy209t32j51-3{list-style-type:none}ul.lst-kix_iwy209t32j51-2{list-style-type:none}ul.lst-kix_7t911kc8ekh1-1{list-style-type:none}.lst-kix_end0j8ux220d-8>li:before{content:"\0025a0  "}ul.lst-kix_7t911kc8ekh1-0{list-style-type:none}ul.lst-kix_7t911kc8ekh1-3{list-style-type:none}ul.lst-kix_7t911kc8ekh1-2{list-style-type:none}ul.lst-kix_7t911kc8ekh1-5{list-style-type:none}ul.lst-kix_7t911kc8ekh1-4{list-style-type:none}ul.lst-kix_7t911kc8ekh1-7{list-style-type:none}ul.lst-kix_7t911kc8ekh1-6{list-style-type:none}ul.lst-kix_7t911kc8ekh1-8{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c13{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;text-indent:36pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c17{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c11{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Arial";font-style:normal}.c14{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c22{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c4{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Arial";font-style:normal}.c8{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c25{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c7{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c3{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c2{padding-top:14pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:left}.c20{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c15{padding-top:0pt;padding-bottom:16pt;line-height:1.15;page-break-after:avoid;text-align:left}.c26{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;text-align:center}.c21{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c23{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c16{font-size:10pt;font-weight:700}.c18{color:inherit;text-decoration:inherit}.c9{width:33%;height:1px}.c6{margin-left:36pt;padding-left:0pt}.c10{padding:0;margin:0}.c5{height:11pt}.c12{margin-left:36pt}.c24{font-size:10pt}.c19{font-weight:700}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c23"><p class="c26 title" id="h.g8yiao5q2f3"><span class="c17">Sito Mobile Capstone Project</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c15 subtitle" id="h.iv3pa6kyrygw"><span class="c22">Authors: Yongguang Qin, Chung Meng Lim, Daniel Park, Quentin Picard</span></p><h2 class="c20" id="h.n6yzrmably8q"><span class="c14">Introduction</span></h2><p class="c3"><span class="c1">For our Capstone Project at NYC Data Science Academy, we chose to work on a big data supervised learning problem provided by an adtech company that specializes in user behavior and location analysis. We chose to focus on the problem of CTR (Click-Thru Rate) estimation with the hope of improving current company metrics. Our client is an active player in Real Time Bidding (RTB) markets and gave us access to 2 weeks of data from 3 exchanges. The data was split in 3 categories:</span></p><ul class="c10 lst-kix_8l7c42d7d1sl-0 start"><li class="c3 c6"><span class="c1">Bid Requests (36 billion rows, ~60 fields): ad space received from the exchange on which the company can bid.</span></li><li class="c3 c6"><span class="c1">Impressions (302 million rows, ~30 fields): ads won by our client during the bidding</span></li><li class="c3 c6"><span class="c1">Clicks (450k non-duplicate clicks, ~30 fields): impressions that were clicked by a user after display</span></li></ul><p class="c3"><span>The following graph</span><sup><a href="#ftnt1" id="ftnt_ref1">[1]</a></sup><span>&nbsp;shows the overall workflow with some companies as illustration. Additional introductory information about the functioning of RTB markets is available </span><span class="c21"><a class="c18" href="https://www.google.com/url?q=https://arxiv.org/pdf/1610.03013.pdf&amp;sa=D&amp;ust=1513961674330000&amp;usg=AFQjCNGyLHdSQWLy_anM9u8MKBlhMKGj0w">here</a></span><sup><a href="#ftnt2" id="ftnt_ref2">[2]</a></sup><span>. </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 374.67px;"><img alt="" src="images/image14.png" style="width: 624.00px; height: 374.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">Our strategy was to explore which machine learning algorithms were used by the industry, implement them and compare the results. We downloaded the data to Spark in order to take advantage of parallel execution and collaborated using Databricks notebooks.</span></p><p class="c3 c5"><span class="c1"></span></p><h2 class="c20" id="h.kfhgrcj1vrl9"><span class="c14">Modeling</span></h2><h4 class="c2" id="h.a6pjg7abo99"><span class="c13">Class imbalance</span></h4><p class="c3"><span class="c1">In our data only about 0.5% of impressions were clicked.This tells us that statistically speaking the clicks (&lsquo;1&rsquo;) are more valuable than the not-clicked ads (&lsquo;0&rsquo;) in order to learn the boundary between the 2 classes. As long as said boundary exist, we should be able to subsample the elements of the majority class with only a small impact on our final results.</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">The graph below shows that the coefficient variances obtained by fitting a model to the training data tapers off as the class ratio increases. </span></p><p class="c3 c5"><span class="c1"></span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 454.32px; height: 359.50px;"><img alt="" src="images/image13.png" style="width: 454.32px; height: 359.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c16">Diminishing returns in unbalanced binary data</span><sup class="c16"><a href="#ftnt3" id="ftnt_ref3">[3]</a></sup></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">For our modeling, we used the workflow described below. We split into training and test according to the date so that it would correspond to a normal production setting in which the object is to predict the click through rate for the next day or next few days. </span></p><p class="c3"><span class="c1">All the 1s were kept in the training set. &nbsp;We ended up with about 11 times more 0s than 1s. In the test set we kept the original inbalance to minimize bias in the prediction. We just applied a unique downsampling ratio to the whole dataset. </span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 463.50px; height: 294.89px;"><img alt="" src="images/image10.png" style="width: 463.50px; height: 294.89px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h4 class="c2" id="h.danvus2tknrg"><span class="c13">Categorical variables </span></h4><p class="c3"><span>All the features in our dataset were categorical</span><span>&nbsp;with</span><span>&nbsp;the exception of age</span><span>;</span><span>&nbsp;we also made</span><span>&nbsp;that</span><span class="c1">&nbsp;categorical through binning, including the extreme version which considers each value as a group. Since most of the features were identifiers with relatively high cardinality (e.g. ad id, campaign id), the traditional treatment of these with one hot encoding impacted performance significantly. This was addressed in the Follow-The-Regularized-Leader model using the &ldquo;hashing trick&rdquo; and forcing sparsity through regularization.</span></p><h4 class="c2" id="h.2odjwjorjdt5"><span>Interactions</span><span>&nbsp;features (conjunctions)</span></h4><p class="c3"><span>A few papers</span><sup><a href="#ftnt4" id="ftnt_ref4">[4]</a></sup><span class="c1">&nbsp;on CTR prediction report good results with the use interaction features. It makes logical sense that an ad for Gucci would have a higher rate of success (as measured by the probability of a click event) on the Vogue website versus motortrend.com. We didn&rsquo;t observe improvements justifying the additional performance drain in our dataset. One explanation is that we were dealing exclusively with ads displayed on apps (e.g. &lsquo;Words with Friends&rsquo;) and not on websites. The algorithm couldn&rsquo;t find as good a content match between those apps and the creatives (ads).</span></p><h4 class="c2" id="h.hf3gclmeenc2"><span class="c13">Models</span></h4><p class="c3"><span>Predicting CTR in the ad industry has been studied extensively in recent years. Logistic Regression is a common algorithm to handle the volume of data efficiently</span><sup><a href="#ftnt5" id="ftnt_ref5">[5]</a></sup><span>. We therefore started to implement the standard Logistic Regression available in the PySpark ML library. It gave decent results (see graph below) and performed better than</span><span>&nbsp;the</span><span class="c1">&nbsp;Decision Tree and Random Forest, which were also available. </span></p><p class="c3"><span>In order to improve performance and predictive accuracy</span><span>,</span><span>&nbsp;we </span><span>proceeded to </span><span>&nbsp;research industry publications for non-standard algorithms.</span><span>&nbsp;We tried t</span><span>he Follow-The-Regularized-Leader Proximal (FTRL) implementations presented by Google</span><span>.</span><sup><a href="#ftnt6" id="ftnt_ref6">[6]</a></sup><span>&nbsp;</span><span>It </span><span>uses a single weight layer to allow the training of large amounts of data. Because we implemented the algorithm from scratch</span><span>,</span><span class="c1">&nbsp;it didn&rsquo;t take full advantage of parallelism in Spark. Still, we were able to train both the sub-sampled and the full dataset (42 million rows in the training set), even with a single thread. Fitting the 42 million rows took approximately 10 hours.</span></p><p class="c3"><span class="c1">FTRL attempts to produce both sparsity and high predictive accuracy. Sparsity is measured by the proportion of non-zero factors in the weight matrix (here, a single column). Having lots of zeros enables low memory usage and fast vector operations.</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">Let&rsquo;s dive into some of the details of the implementation.</span></p><p class="c3"><span class="c1">Stochastic Gradient Descent performs the update:</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 116.00px; height: 10.67px;"><img alt="" src="images/image5.png" style="width: 116.00px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Where t is the round of update (one round for each training observation), </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 10.67px;"><img alt="" src="images/image26.png" style="width: 12.00px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>is the learning rate in round t and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 14.67px; height: 9.33px;"><img alt="" src="images/image17.png" style="width: 14.67px; height: 9.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp;is the weight layer in round t.</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">FTRL instead tries to solve for the weight satisfying :</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 370.67px; height: 45.33px;"><img alt="" src="images/image19.png" style="width: 370.67px; height: 45.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>where: </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 69.33px; height: 16.00px;"><img alt="" src="images/image15.png" style="width: 69.33px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">and using the notation: </span></p><p class="c7"><span>&nbsp;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 84.00px; height: 45.33px;"><img alt="" src="images/image9.png" style="width: 84.00px; height: 45.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>H. Brendan McMahan</span><sup><a href="#ftnt7" id="ftnt_ref7">[7]</a></sup><span>&nbsp;shows that the 2 equations above generate identical coefficients when the </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image1.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp;term is removed.</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">For memory efficiency we store:</span></p><p class="c7"><span>&nbsp;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 162.67px; height: 46.67px;"><img alt="" src="images/image16.png" style="width: 162.67px; height: 46.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">and using:</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 232.00px; height: 16.00px;"><img alt="" src="images/image6.png" style="width: 232.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">&nbsp;</span></p><p class="c3"><span>we solve for </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 14.67px; height: 9.33px;"><img alt="" src="images/image17.png" style="width: 14.67px; height: 9.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp;in closed form and get the equations detailed below in the algorithm summary.</span></p><hr style="page-break-before:always;display:none;"><p class="c3 c5"><span class="c1"></span></p><p class="c7"><span class="c19">Per-Coordinate FTRL-Proximal with </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image1.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c19">&nbsp;and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image1.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c19 c25">&nbsp;Regularization</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 220.00px; height: 14.67px;"><img alt="" src="images/image3.png" style="width: 220.00px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 294.67px; height: 16.00px;"><img alt="" src="images/image24.png" style="width: 294.67px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 122.67px; height: 14.67px;"><img alt="" src="images/image12.png" style="width: 122.67px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 340.00px; height: 16.00px;"><img alt="" src="images/image21.png" style="width: 340.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 565.33px; height: 48.00px;"><img alt="" src="images/image23.png" style="width: 565.33px; height: 48.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c5"><span class="c1"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 396.00px; height: 16.00px;"><img alt="" src="images/image27.png" style="width: 396.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 168.00px; height: 16.00px;"><img alt="" src="images/image11.png" style="width: 168.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 104.00px; height: 14.67px;"><img alt="" src="images/image8.png" style="width: 104.00px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 329.33px; height: 16.00px;"><img alt="" src="images/image22.png" style="width: 329.33px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp;</span></p><p class="c0 c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 205.33px; height: 28.00px;"><img alt="" src="images/image28.png" style="width: 205.33px; height: 28.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 141.33px; height: 13.33px;"><img alt="" src="images/image25.png" style="width: 141.33px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp;</span></p><p class="c0 c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 85.33px; height: 17.33px;"><img alt="" src="images/image18.png" style="width: 85.33px; height: 17.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 46.67px; height: 14.67px;"><img alt="" src="images/image2.png" style="width: 46.67px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 46.67px; height: 14.67px;"><img alt="" src="images/image2.png" style="width: 46.67px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span class="c1">Notes: </span></p><ul class="c10 lst-kix_9e3u2uh7e01s-0 start"><li class="c3 c6"><span>Learning rate<br>&lsquo;Per coordinate&rsquo; refers to the fact that the algorithm can learn at different speeds for different features. If a feature has never been seen, then the algorithm will have to learn fast to use this new information. Conversely</span><span>,</span><span>&nbsp;if a feature has already occured many times</span><span>,</span><span>&nbsp;</span><span>the algorithm does not have to learn anew but</span><span class="c1">&nbsp;just tweak the existing weight.</span></li><li class="c3 c6"><span>Feature hash trick<br>A hashing trick used in the industry forces all features values into a set maximum (e.g. 2^20 which is about 1 million). This is meant to improve performance but could lead to &lsquo;collisions&rsquo; if the number of unique values across all features is above that number. In practice, because the </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image1.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp;term is good at introducing sparsity, our implementation only created about 50,000 non-zero values on the full dataset.</span></li></ul><p class="c3 c5"><span class="c1"></span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 302.67px;"><img alt="" src="images/image20.png" style="width: 624.00px; height: 302.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c4">PySpark FTRL Implementation (model fit method)</span></p><h4 class="c2" id="h.efriijv99k9a"><span class="c13">Evaluating Model Performance</span></h4><p class="c3"><span class="c1">Our main performance metric to compare algorithms was Area Under the Receiver Operating Characteristic Curve (AUROC). Area Under Precision-Recall and LogLoss are 2 other common metrics but we couldn&rsquo;t interpret them as easily (note that for LogLoss probability estimates are affected by the downsampling and need to be transformed back).</span></p><p class="c3"><span>A summary of the results is presented below:</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 453.50px; height: 340.13px;"><img alt="" src="images/image7.png" style="width: 453.50px; height: 340.13px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c4">ROC Curve - Top 5 algorithms </span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span>FTRL performed best</span><span>, which is consistent with industry research,</span><span>&nbsp;It was also able to squeeze additional information when given the full dataset (AUROC was still in the same range</span><span>,</span><span class="c1">&nbsp;though, as expected from our subsampling analysis). Simple logistic was the next best performing model.</span></p><h4 class="c2" id="h.c9pnl6xtup3"><span class="c13">Other Analysis</span></h4><p class="c3"><span>We plotted the decrease in performance when predicting CTR on impressions f</span><span>u</span><span class="c1">rther into the future. Although we only had a total of 22 days of data, we were able to observe a decrease in predictive accuracy. We would expect this trend to be more significant if more days were available, meaning than the model would need to be refreshed at regular intervals in a production environment.</span></p><p class="c3 c5"><span class="c1"></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 232.00px;"><img alt="" src="images/image4.png" style="width: 624.00px; height: 232.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c4">AUROC Decay (FTRL algorithm)</span></p><p class="c3 c5"><span class="c1"></span></p><h2 class="c20" id="h.vp6igpks3mhj"><span class="c14">Conclusion</span></h2><p class="c3"><span>Analysing real world production data was an exciting challenge. The team experienced &lsquo;classic&rsquo; big data struggles including inconsistencies/ noise in a massive dataset and cluster reboots during model runs. We also noticed that Spark is a relatively new technology with some outstanding bugs and missing functionality compared to Scikit-Learn. In the future we would love to tweak our algorithm on more data and maybe try to bring an improvement</span><span>-- </span><span>even</span><span>&nbsp;if it is just a</span><span>&nbsp;small</span><span>&nbsp;one --</span><span>&nbsp;to the FTRL implementation</span><span>.</span></p><p class="c3 c5"><span class="c1"></span></p><hr class="c9"><div><p class="c8"><a href="#ftnt_ref1" id="ftnt1">[1]</a><span class="c11">&nbsp;Weinan Zhang and Jian Xu. Learning, Prediction and Optimisation in RTB Display Advertising</span></p></div><div><p class="c8"><a href="#ftnt_ref2" id="ftnt2">[2]</a><span class="c11">&nbsp;Wang Jun, Zhang, Weinan, Yuan, Shuai. Display Advertising with Real-Time Bidding (RTB) and Behavioural Targeting</span></p><p class="c5 c8"><span class="c11"></span></p></div><div><p class="c8"><a href="#ftnt_ref3" id="ftnt3">[3]</a><span class="c24">&nbsp;Trevor Hastie, Robert Tibshirani Jerome Friedman. </span><span class="c21 c24"><a class="c18" href="https://www.google.com/url?q=https://www.youtube.com/watch?v%3DGavRXXEHGqU&amp;sa=D&amp;ust=1513961674345000&amp;usg=AFQjCNGuhzlAFfV_7nGJVp9N78mm308dTg">Statistical Learning course</a></span><span class="c11">&nbsp;</span></p></div><div><p class="c8"><a href="#ftnt_ref4" id="ftnt4">[4]</a><span class="c11">&nbsp;Yuchin Juan, Yong Zhuang, Wei-Sheng Chin, Chih-Jen Lin. Field-aware Factorization Machines for CTR Prediction</span></p></div><div><p class="c8"><a href="#ftnt_ref5" id="ftnt5">[5]</a><span class="c11">&nbsp;Olivier Chapelle, Eren Manavoglu, Romer Rosales. Simple and Scalable Response Prediction for Display Advertising</span></p></div><div><p class="c8"><a href="#ftnt_ref6" id="ftnt6">[6]</a><span class="c11">&nbsp;H. Brendan McMahan, Gary Holt, D. Sculley, Michael Young, Dietmar Ebner, Julian Grady, Lan Nie, Todd Phillips, Eugene Davydov, Daniel Golovin, Sharat Chikkerur, Dan Liu, Martin Wattenberg, Arnar Mar Hrafnkelsson, Tom Boulos, Jeremy Kubica. Ad Click Prediction: a View from the Trenches</span></p></div><div><p class="c8"><a href="#ftnt_ref7" id="ftnt7">[7]</a><span class="c11">&nbsp;H. Brendan McMahan. Follow-the-Regularized-Leader and Mirror Descent: Equivalence Theorems and L1 Regularization</span></p></div></body></html>